$(document).ready(function(){$body=$("body");var a;$(document).ajaxStart(function(){a=setTimeout(function(){$body.addClass("loading")},200)}).ajaxStop(function(){clearTimeout(a);$body.removeClass("loading")});$("#input").keypress(function(a){13==a.keyCode&&triageInput($("#input").val())})});
function triageInput(a){var c=/^[a-zA-Z]+$/;if(6>=a.length&&!a.match(c))for(c=0;c<bus_stops_array.length;c++){if(bus_stops_array[c]===a){clickThroughToStop(a);var b=[];null==localStorage.getItem("dbl_last_stops")?b=[]:b=JSON.parse(localStorage.getItem("dbl_last_stops"));b.unshift(a);b=b.filter(function(b,a,c){return c.indexOf(b)==a});5<b.length&&(b.length=5);localStorage.setItem("dbl_last_stops",JSON.stringify(b))}}else geocodeAddress(a)}
function addressSearch(){input=$("#input2").val();geocodeAddress(input)}function geocodeAddress(a){address=a+", Dublin, Ireland";(new google.maps.Geocoder).geocode({address:address},function(a,b){"OK"===b?chooseStop(a[0].geometry.location.lat(),a[0].geometry.location.lng()):(console.log("Geocode was not successful for the following reason: "+b),alert("Could not find address! Try a different query."))})}
function chooseStop(a,c){$("#overlay").addClass("map_overlay");$("#stop_picker").dialog("open");var b=.9*$(window).width(),d=.9*$(window).height();$("#stop_picker").dialog({modal:!0,width:b,height:d,close:function(){$("#overlay").removeClass("map_overlay")}});$("#stop_picker").append($("<div id='stoppickermap' class='remove' style='height: 100%; width:100%;'></div>"));getStopPickerMap(a,c)}
function getStopPickerMap(a,c){var b=new google.maps.LatLng(a,c);var d=new google.maps.Map(document.getElementById("stoppickermap"),{center:b,zoom:17,styles:mapstyles,gestureHandling:"greedy"});var e;$.each(bus_stops_extd,function(a,c){busstop_pos=new google.maps.LatLng(c.lat,c.lng);if(650>google.maps.geometry.spherical.computeDistanceBetween(busstop_pos,b)){var h=c.routes.split(","),f="";$.each(h.slice(0,10),function(a,b){f+='<span class="mdl-chip" style="margin-right: 2px; background-color: #3F51B5; color:#FFEB3B;"><span class="mdl-chip__text">'+
b+"</span></span>"});e='<div><p style="font-size: 16px;"><strong>'+c.stopname+"</strong> - stop id: "+c.stopid+"</p></div><div>"+f+'</div><div>(possibly more, please see live departures)</div><br><a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" onclick="clickThroughToStop(\''+c.stopid+"')\">Live departures</a>";var k=new google.maps.InfoWindow({content:e}),g=new google.maps.Marker({position:busstop_pos,map:d,icon:"file/testpole1.png",label:{text:c.stopid,fontWeight:"bold",
fontSize:"10px"}});g.addListener("click",function(){k.open(d,g)})}});new google.maps.Marker({position:b,map:d})}function clickThroughToStop(a){refresh();getBusInfo(a);getStopInfo(a)}function getBusInfo(a){$.getJSON("https://bvcors.herokuapp.com/https://data.dublinked.ie/cgi-bin/rtpi/realtimebusinformation?stopid="+a+"&format=json?callback?",function(a){0==a.errorcode?processBusData(a):console.log("failed to retrieve stop info")})}
function processBusData(a){$("#bus_info").html('<span id="stop_number">Stop Number: '+a.stopid+'</span><div class="mdl-layout-spacer"></div><div class="mdl-layout-spacer"></div><div>Last updated: '+a.timestamp+"</div");$("#results_table").append($("<div id='response'></div>"));"No Results"==a.errormessage&&(console.log(a.errormessage),$("#row_results").append($('<tr><td colspan="3" style="text-align:center; ">No busses found! \u2639</td></tr>')));$.each(a.results,function(a,b){duetime_suffix="Due"!=
b.duetime?" min":"";retard=b.duetime-b.departureduetime;$("#row_results").append($('<tr><td class="mdl-data-table__cell--non-numeric">'+b.route+'</td><td class="mdl-data-table__cell--non-numeric">'+b.destination+'</td><td class="mdl-data-table__cell--non-numeric">'+b.duetime+duetime_suffix+"</td></tr>"))})}
function getStopInfo(a){$.getJSON("https://bvcors.herokuapp.com/https://data.dublinked.ie/cgi-bin/rtpi/busstopinformation?stopid="+a+"&format=json?callback?",function(a){0==a.errorcode?processStopData(a):console.log("failed to retrieve stop info")})}
function processStopData(a){"No Results"==a.errormessage&&(console.log(a.errormessage),$("#bus_stop_name").append($('<span id="stop_name">Not found.</span>')));$.each(a.results,function(a,b){stop_name=""!=b.shortname?b.shortname:"Not found.";$("#bus_stop_name").append($('<span id="stop_name"><strong>'+stop_name+'</strong></span><span class="remove" style="margin-left: 5px"><button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" onclick="clickThroughToStop('+b.stopid+')"><i class="material-icons">refresh</i></button></span> <span class="remove" style="margin-left: 5px"><button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" onclick="location.href = `index.html`;"><i class="material-icons">home</i></button></span>'));
$("#topleft").append($('<div class="searchbox2 remove"><input class="searchfield2" placeholder="Search" type="text" id="input2"></div>'));lat=parseFloat(b.latitude);lng=parseFloat(b.longitude);drawMap(lat,lng);maps_url="https://www.google.ie/maps/?q="+b.latitude+","+ +b.longitude;maps_html="<button class='remove mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect' onclick=\"window.location.href='"+maps_url+"'\"><i class='material-icons'>directions</i></button>";$("#links").append($(maps_html));
$.each(b.operators,function(a,b){$.each(b.routes,function(a,b){$("#chips").append($('<span class="mdl-chip chip" style="margin:3px; background-color:#f0f0f0; color: #3F51B5;"><span class="mdl-chip__text">'+b+"</span></span>"))})});$("#input2").keypress(function(a){13==a.keyCode&&triageInput($("#input2").val())})})}
function drawMap(a,c){$("#map").height(176);var b={lat:a,lng:c},d=new google.maps.Map(document.getElementById("map"),{zoom:17,center:b,styles:mapstyles});(new google.maps.TransitLayer).setMap(d);new google.maps.Marker({position:b,map:d,icon:"file/pole32.png"});d.panTo(b)}
function refresh(){$(".remove").remove();$("#results_table").remove();$("#stop_number").remove();$("#stop_name").remove();$("#initial_stop_name").remove();$(".mdl-chip").remove();$("#dialog").dialog("close");$("#stop_picker").dialog("close");results_table='<table id="results_table" class="mdl-data-table mdl-js-data-table mdl-shadow--2dp" style="width:100%;"><thead><tr><th class="mdl-data-table__cell--non-numeric">Bus</th><th class="mdl-data-table__cell--non-numeric">Destination</th><th class="mdl-data-table__cell--non-numeric">Due in</th></tr></thead><tbody id="row_results"></tbody></table>';
$("#results_body").append(results_table)}var mapstyles=[{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"on"}]},{featureType:"water",stylers:[{color:"#2196f3"}]}];